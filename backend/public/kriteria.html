<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kelola Kriteria | SPK Siswa Berprestasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-[Poppins] flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 bg-gray-900 text-gray-300 flex flex-col fixed h-full">
    <div class="text-center text-white text-xl font-semibold py-5 border-b border-gray-700">
      üßÆ SPK Siswa
    </div>
    <nav class="flex-1 p-4 space-y-2">
      <a href="index.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-house"></i> <span>Dashboard</span>
      </a>
      <a href="siswa.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-people"></i> <span>Kelola Siswa</span>
      </a>
      <a href="kriteria.html" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-blue-600 text-white">
        <i class="bi bi-list-check"></i> <span>Kelola Kriteria</span>
      </a>
      <a href="nilai.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-pencil-square"></i> <span>Input Nilai</span>
      </a>
      <a href="hasil.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-bar-chart"></i> <span>Hasil SPK</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 ml-64">
    <!-- Navbar -->
    <header class="bg-blue-600 text-white px-6 py-4 shadow flex items-center justify-between">
      <h1 class="text-lg font-semibold flex items-center gap-2">
        <i class="bi bi-list-check text-xl"></i> Kelola Kriteria
      </h1>
      <a href="login.html">
    <button class="bg-blue-700 hover:bg-blue-800 px-4 py-1 rounded-lg text-sm">
        Logout
    </button>
</a>
    </header>

    <!-- Content Area -->
    <main class="p-8 space-y-8">
      <!-- Form Tambah Kriteria -->
      <section class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">‚ûï Tambah Kriteria</h2>

        <form id="formKriteria" class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm text-gray-600 mb-1">Nama Kriteria</label>
            <input type="text" id="nama_kriteria" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none" placeholder="Contoh: Nilai Akademik" required>
          </div>

          <div>
            <label class="block text-sm text-gray-600 mb-1">Bobot</label>
            <input type="number" step="0.01" id="bobot" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none" placeholder="Contoh: 0.35" required>
          </div>

          <div>
            <label class="block text-sm text-gray-600 mb-1">Sifat</label>
            <select id="sifat" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none" required>
              <option value="">-- Pilih Sifat --</option>
              <option value="benefit">Benefit</option>
              <option value="cost">Cost</option>
            </select>
          </div>

          <div class="md:col-span-3">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow mt-2 transition-all">
              <i class="bi bi-plus-circle"></i> Simpan
            </button>
          </div>
        </form>
      </section>

      <!-- Tabel Kriteria -->
      <section class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">üìã Daftar Kriteria</h2>

        <div class="overflow-x-auto">
          <table class="min-w-full border border-gray-200 text-sm">
            <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
              <tr>
                <th class="px-4 py-2 border">No</th>
                <th class="px-4 py-2 border">Nama Kriteria</th>
                <th class="px-4 py-2 border text-center">Bobot</th>
                <th class="px-4 py-2 border text-center">Sifat</th>
                <th class="px-4 py-2 border text-center">Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelKriteria" class="text-gray-700 divide-y divide-gray-100"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

 <script>
  const baseURL = "http://localhost:5000/api/kriteria";
  const token = localStorage.getItem("userToken");

  // üîπ Ambil data kriteria berdasarkan user login
  async function loadKriteria() {
    try {
      const res = await fetch(baseURL, {
        headers: { "Authorization": `Bearer ${token}` },
      });
      const result = await res.json();

      const data = result.data || []; // ambil field 'data' dari backend
      const tbody = document.getElementById("tabelKriteria");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-4">Belum ada data kriteria</td></tr>`;
        return;
      }

      data.forEach((item, i) => {
        tbody.innerHTML += `
          <tr class="hover:bg-gray-50 text-center">
            <td class="px-4 py-2 border">${i + 1}</td>
            <td class="px-4 py-2 border font-medium">${item.nama_kriteria}</td>
            <td class="px-4 py-2 border">${item.bobot}</td>
            <td class="px-4 py-2 border">
              ${
                item.sifat === "benefit"
                  ? '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">Benefit</span>'
                  : '<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-medium">Cost</span>'
              }
            </td>
            <td class="px-4 py-2 border">
              <button onclick="hapusKriteria(${item.id_kriteria})"
                      class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition">
                <i class="bi bi-trash"></i> Hapus
              </button>
            </td>
          </tr>
        `;
      });
    } catch (err) {
      console.error("Gagal memuat data:", err);
    }
  }

  // üîπ Tambah kriteria
  document.getElementById("formKriteria").addEventListener("submit", async (e) => {
    e.preventDefault();
    const nama = document.getElementById("nama_kriteria").value.trim();
    const bobot = document.getElementById("bobot").value.trim();
    const sifat = document.getElementById("sifat").value;

    try {
      const res = await fetch(baseURL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({ nama_kriteria: nama, bobot, sifat })
      });

      const data = await res.json();
      if (res.ok) {
        alert("‚úÖ " + data.message);
        e.target.reset();
        loadKriteria();
      } else {
        alert("‚ùå " + (data.message || "Gagal menambah kriteria"));
      }
    } catch (err) {
      console.error("Error:", err);
      alert("‚ùå Terjadi kesalahan saat menambah kriteria.");
    }
  });

  // üîπ Hapus kriteria
  async function hapusKriteria(id) {
    if (!confirm("Yakin mau hapus kriteria ini?")) return;

    try {
      const res = await fetch(`${baseURL}/${id}`, {
        method: "DELETE",
        headers: { "Authorization": `Bearer ${token}` },
      });

      const data = await res.json();
      if (res.ok) {
        alert("üóëÔ∏è " + data.message);
        loadKriteria();
      } else {
        alert("‚ùå " + (data.message || "Gagal menghapus kriteria."));
      }
    } catch (err) {
      console.error("Error:", err);
      alert("‚ùå Terjadi kesalahan saat menghapus.");
    }
  }

  // Jalankan pertama kali
  document.addEventListener("DOMContentLoaded", loadKriteria);
</script>

</body>
</html>

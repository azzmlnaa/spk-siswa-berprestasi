<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kelola Siswa | SPK Siswa Berprestasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-[Poppins] flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 bg-gray-900 text-gray-300 flex flex-col fixed h-full">
    <div class="text-center text-white text-xl font-semibold py-5 border-b border-gray-700">
      üßÆ SPK Siswa
    </div>
    <nav class="flex-1 p-4 space-y-2">
      <a href="index.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-house"></i> <span>Dashboard</span>
      </a>
      <a href="siswa.html" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-blue-600 text-white">
        <i class="bi bi-people"></i> <span>Kelola Siswa</span>
      </a>
      <a href="kriteria.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-list-check"></i> <span>Kelola Kriteria</span>
      </a>
      <a href="nilai.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-pencil-square"></i> <span>Input Nilai</span>
      </a>
      <a href="hasil.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
        <i class="bi bi-bar-chart"></i> <span>Hasil SPK</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 ml-64">
    <!-- Navbar -->
    <header class="bg-blue-600 text-white px-6 py-4 shadow flex items-center justify-between">
      <h1 class="text-lg font-semibold flex items-center gap-2">
        <i class="bi bi-person-lines-fill text-xl"></i> Kelola Siswa
      </h1>
      <a href="login.html">
    <button class="bg-blue-700 hover:bg-blue-800 px-4 py-1 rounded-lg text-sm">
        Logout
    </button>
</a>
    </header>

    <!-- Content Area -->
    <main class="p-8 space-y-8">
      <!-- Form Tambah Siswa -->
      <section class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">‚ûï Tambah Siswa</h2>
        <form id="formSiswa" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-gray-600 mb-1">Nama Siswa</label>
            <input type="text" id="nama_siswa" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none" placeholder="Masukkan nama siswa" required>
          </div>
          <div>
            <label class="block text-sm text-gray-600 mb-1">Kelas</label>
            <input type="text" id="kelas" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none" placeholder="Masukkan kelas" required>
          </div>
          <div class="md:col-span-2">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow mt-2 transition-all">
              <i class="bi bi-plus-circle"></i> Tambah
            </button>
          </div>
        </form>
      </section>

      <!-- Tabel Siswa -->
      <section class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">üìã Daftar Siswa</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full border border-gray-200 text-sm">
            <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
              <tr>
                <th class="px-4 py-2 border">No</th>
                <th class="px-4 py-2 border">Nama Siswa</th>
                <th class="px-4 py-2 border">Kelas</th>
                <th class="px-4 py-2 border text-center">Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelSiswa" class="text-gray-700 divide-y divide-gray-100"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

 <script>
  const baseURL = "http://localhost:5000/api/siswa";

  // üîπ Fungsi untuk memuat data siswa
  async function loadSiswa() {
    const token = localStorage.getItem("userToken");
    if (!token) {
      alert("Token tidak ditemukan! Silakan login ulang.");
      window.location.href = "login.html";
      return;
    }

    try {
      const res = await fetch(baseURL, {
        headers: { "Authorization": `Bearer ${token}` }
      });

      const data = await res.json();
      const tbody = document.getElementById("tabelSiswa");
      tbody.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="text-center py-4 text-gray-500">
              Belum ada data siswa.
            </td>
          </tr>`;
        return;
      }

      data.forEach((item, i) => {
        tbody.innerHTML += `
          <tr class="hover:bg-gray-50 text-center">
            <td class="px-4 py-2 border">${i + 1}</td>
            <td class="px-4 py-2 border font-medium">${item.nama_siswa}</td>
            <td class="px-4 py-2 border">${item.kelas}</td>
            <td class="px-4 py-2 border">
              <button onclick="hapusSiswa(${item.id_siswa})"
                      class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition">
                <i class="bi bi-trash"></i> Hapus
              </button>
            </td>
          </tr>
        `;
      });
    } catch (err) {
      console.error("Gagal memuat data:", err);
      alert("‚ùå Gagal memuat data siswa.");
    }
  }

  // üîπ Tambah siswa
  document.getElementById("formSiswa").addEventListener("submit", async (e) => {
    e.preventDefault();

    const nama = document.getElementById("nama_siswa").value.trim();
    const kelas = document.getElementById("kelas").value.trim();
    const token = localStorage.getItem("userToken");

    if (!token) {
      alert("Token tidak ditemukan! Silakan login ulang.");
      window.location.href = "login.html";
      return;
    }

    if (!nama || !kelas) {
      alert("‚ùå Nama dan kelas tidak boleh kosong!");
      return;
    }

    try {
      const res = await fetch(baseURL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({ nama_siswa: nama, kelas })
      });

      const data = await res.json();

      if (res.ok) {
        alert("‚úÖ " + data.message);
        e.target.reset();
        loadSiswa(); // reload tabel
      } else {
        alert("‚ùå " + (data.message || "Gagal menambah siswa."));
      }
    } catch (err) {
      console.error("Error:", err);
      alert("‚ùå Terjadi kesalahan saat mengirim data.");
    }
  });

  // üîπ Hapus siswa
  async function hapusSiswa(id) {
    const token = localStorage.getItem("userToken");
    if (!token) {
      alert("Token tidak ditemukan!");
      return;
    }

    if (confirm("Yakin ingin menghapus siswa ini?")) {
      try {
        const res = await fetch(`${baseURL}/${id}`, {
          method: "DELETE",
          headers: { "Authorization": `Bearer ${token}` }
        });

        const data = await res.json();
        if (res.ok) {
          alert("üóëÔ∏è " + data.message);
          loadSiswa();
        } else {
          alert("‚ùå " + (data.message || "Gagal menghapus siswa."));
        }
      } catch (err) {
        console.error("Error:", err);
        alert("‚ùå Terjadi kesalahan saat menghapus siswa.");
      }
    }
  }

  // Jalankan saat halaman dimuat
  document.addEventListener("DOMContentLoaded", loadSiswa);
</script>

</body>
</html>
